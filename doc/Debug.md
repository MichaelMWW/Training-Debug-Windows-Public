## Prerequirements
- Assembly Language
	- x86: [Architecture](https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/x86-architecture), [Instructions](https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/x86-instructions)
	- x64: [Architecture](https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/x64-architecture), [Instructions](https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/x64-instructions)
	- [Writing Functions with Inline Assembly](https://msdn.microsoft.com/en-us/library/5sds75we.aspx)
- C++
	- [Welcome Back to C++ (Modern C++)](https://msdn.microsoft.com/en-us/library/hh279654.aspx)
	- [C++ Language Reference](https://msdn.microsoft.com/en-us/library/3bstk3k5.aspx)
	- [Lambda Expressions in C++](https://msdn.microsoft.com/en-us/library/dd293608.aspx)
	- [C++ Standard Library Reference](https://msdn.microsoft.com/en-us/library/cscc687y.aspx)
- Windows操作系统基础
	- [Windows Internals Book](https://docs.microsoft.com/en-us/sysinternals/learn/windows-internals)
	- [Windows Sysinternals](https://docs.microsoft.com/en-us/sysinternals/): [Forums Support](https://social.technet.microsoft.com/Forums/en-US/home?category=sysinternals&amp;filter=alltypes&amp;sort=lastpostdesc), [一句话介绍](http://blog.wuwenxiang.net/Windows-Sysinternals), [使用文档](https://docs.microsoft.com/en-us/sysinternals/learn/troubleshooting-book)
- [Python](https://www.python.org/downloads/)：[Installation Steps](https://github.com/wu-wenxiang/Training-Python-Public/blob/master/doc/Installation-Python.md)
- [Visual Studio](https://visualstudio.microsoft.com/zh-hans/downloads/)

## Content
- Quick Start
	- [Sysinternals](https://docs.microsoft.com/en-us/sysinternals/downloads/): Download / Unzip / Shortcut / Zoomit / "as is"
	- [Windbg](https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/debugger-download-tools): Installation / Onluanch notebook / Attach notebook / Detach
	- Python [QuickStart](https://www.python.org/about/gettingstarted/)
		- [Tiobe Index](https://www.tiobe.com/tiobe-index/): 2004
		- [hacker-howto: Learning Programming](https://translations.readthedocs.io/en/latest/hacker_howto.html#id12) Python -> Java/C# -> C/C++
		- Demo: Read contents from a text file
		- Demo: Count the words
		- Demo: Sort by alpha & length
		- Demo: Scripts with IDLE, also vscode / vs / eclipse-pydev / pycharm
		- Demo: pykd hello world
- About Symbol
	- Demo: Dump call stack without & with symbol
	- Set environment variable: `_NT_SYMBOL_PATH`
	- Doc: [Debugging with Symbols](https://docs.microsoft.com/en-us/windows/desktop/dxtecharts/debugging-with-symbols)
		- What does the symbol path syntax mean?
		- Build server
	- Demo: Search symbol path in target assembly with Python ???
	- Demo: Search source path in symbol file with Python ???
	- Demo: [Dumpbin](https://msdn.microsoft.com/en-us/library/c1h23y6c.aspx?f=255&MSPPError=-2147217396)
		- `dumpbin /symbols CrashMe.exe`
		- `dumpbin /PDBPATH:VERBOSE CrashMe.exe`
		- `dumpbin /headers CrashMe.exe`
	- Demo: [pdbcopy](https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/using-pdbcopy)
		- `pdbcopy CrashMe.pdb public.pdb -p`
		- `dv` & "source lines" differences
	- Demo: [chkmatch](http://www.debuginfo.com/tools/chkmatch.html)：
		- `chkmatch -c ExeFile DebugInfoFile`
		- `chkmatch -m ExeFile DebugInfoFile`
	- Demo: [Force Load Symbol](http://ntcoder.com/bab/2012/03/06/how-to-force-symbol-loading-in-windbg/): 
		- `.symopt+ 0x40`
		- `.reload /f /i test.exe`
		- [`.reload /f /i MyDll.dll=77777777`](https://stackoverflow.com/questions/10979418/forcing-windbg-to-load-symbols-of-an-unloaded-module)
	- Demo: [Symchk](https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/using-symchk)
		- `"c:\Program Files\Debugging Tools for Windows\symchk" testing.dll /s`
	- Demo: Export functions ???
		- `dumpbin /exports xxx.dll`
		- Static call ???
		- Dynamic call ??? [GetProcAddress](https://docs.microsoft.com/en-us/windows/desktop/api/libloaderapi/nf-libloaderapi-getprocaddress)
		- Python call ??? mydebgger
		
				from ctypes import *
				msvcrt = cdll.msvcrt
				msg = b"Hello\n"
				msvcrt.printf(b"aStr: %s", msg)
		- Call internal functions by [SymFromName](https://docs.microsoft.com/en-us/windows/desktop/api/dbghelp/nf-dbghelp-symfromname)
		- Real case: linkinfo ???
		- Real case: scan ???
	- What the order when windbg load symbols?
		- Demo: Procmon ???
	- What if without symbol?
		- COM/COM+/DCOM ???
- About Debugger
	- What's the differents between c call & standard call?
		- cdll：参数列表从右向左入栈，调用者负责清栈
		- windll: stdcall, Win32 API原生调用约定，还是从右向左入栈，但是被调用的函数自己清栈
		- oledll: 与windll完全相似，但oledall会假定其载入的函数会统一返回一个Widnows HRESULT错误编码。这类错误编码专门服务于COM（组建对象模型）函数，用于表示错误信息。
		- Demo: x86 assembly & stack
		
				int my_socks(arg1, arg2, arg3)
				{
					char testLocals;
					...
				}
	- What's the basic principle of the debugger?
		- 调试器基本功能：运行/暂停执行/单步执行/设置断点/修改寄存器和内存数据/捕获异常事件
		- 白盒：源码级别的跟踪调试，开发阶段
		- 黑盒：汇编级别的调试
		- 内核态调试：ring0，wireshark与内核态网卡驱动程序进行交互
		- 用户态调试：ring3
		- Windbg/OllyDbg，gdb，PyDbg，Immunity Debugger
		- 智能调试器：自行编写脚本插件，Not AI
		- 调试器原理
			- 无限循环，等待调试事件
			- 事件发生，调用处理历程
			- 处理完毕，继续无限循环，等待调试事件
	- List the typical debug events
		- 断点触发
		- 非法内存操作（Access Violation / Segment Fault）
		- 由被调试程序抛出的异常
		- 其它：进程/线程创建，动态链接库的运行时导入
	- What's the differences between soft, hard and memory breakpoints?
		- 软断点
			- 实现方式是通过替换操作码的首字节为CC，**INT3**事件

					# 设置软断点之前的操作码
					0x44332211:	8BC3	MOV EAX, EBX
					# 设置软断点之后的操作码 
					0x44332211:	CCC3	MOV EAX, EBX
			- INT3事件处理函数会检查断点列表，将其恢复
			- 优点：可以设置无数个
			- 缺点：绕不开CRC校验
		- 硬件断点
			- 8个调试寄存器
				- DR0-DR3：内存地址，因此**最多使用4个硬件断点**
				- DR4/DR5: 保留
				- DR6: 调试状态寄存器，上一次断点出发所产生的调试事件类型信息
				- DR7: 硬件断点的激活开关，存储各个断点的触发条件信息，可以设定触发条件
					- 某个地址上的指令被执行：函数入口，函数入口+偏移
					- 当数据被写入一个特定内存地址：ba
					- 当数据被读出或写入（不包括执行）一个特定非可执行内存地址
			- 硬件断电是 **INT1** 事件
		- 内存断点
			- 改变一个内存区域或一个内存页的访问权限，内存页是操作系统可以一次处理的最小内存块
			- 访问权限
				- 页可执行：读/写 -> AV
				- 页可读：写/执行 -> AV
				- 页可写
				- 保护页：任何访问 -> 一次性AV，然后恢复到之前状态
			- 可以组合权限，比如
				- 读+写
				- 读+执行
			- 保护页
				- 隔离“堆”和“栈”
				- 确保内存块增长不会超过某一边界
				- 用于实现**内存断点机制**：比如对某缓存区进行页保护，等数据写入时就可以被捕捉到事件
			- 优点：也可以绕过CRC，并且可以设置无数断点
			- 缺点：必须以内存页为单位
	- How to implement Onlaunch debugging?
		- [CreateProcessA()](https://docs.microsoft.com/en-us/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createprocessa)，Demo: [my_test.py](https://github.com/wu-wenxiang/Training-Python/blob/master/Python-Common/debug/grayHat-src/my_test.py) ???
			- lpApplicationName：文件路径
			- lpCommandLine：命令行参数
			- dwCreationFlags：使生成的进程自动具备可调试特性
			- lpStartupInfo：指定进程的启动方式
			- lpProcessInformation：记录进程启动成功后的相关信息
	- How to implement Attach debugging?
		- [my_test.py](https://github.com/wu-wenxiang/Training-Python/blob/master/Python-Common/debug/grayHat-src/my_test.py) ???
		- [OpenProcess](https://docs.microsoft.com/en-us/windows/desktop/api/processthreadsapi/nf-processthreadsapi-openprocess)：获取指向目标进程的句柄，用于判断是否能顺利访问目标进程
			- dwDesiredAccess：索要哪种类型的访问权限，一般`PROCESS_ALL_ACCESS`
			- bInheritHandle：False
			- dwProcessId：PID
		- [DebugActiveProcess](https://msdn.microsoft.com/en-us/library/windows/desktop/ms679295(v=vs.85).aspx)：Attach住对应的进程
		- [WaitForDebugEvent](https://msdn.microsoft.com/en-us/library/windows/desktop/ms681423(v=vs.85).aspx)：在循环中反复调用这个函数，捕捉目标进程中的调试事件
	- How to implement Breakpoint?
		- [ReadProcessMemory](https://msdn.microsoft.com/en-us/library/windows/desktop/ms680553(v=vs.85).aspx) / [WriteProcessMemory](https://msdn.microsoft.com/en-us/library/windows/desktop/ms681674(v=vs.85).aspx)
		- [GetMoudleHandle](https://docs.microsoft.com/en-us/windows/desktop/api/libloaderapi/nf-libloaderapi-getmodulehandlea)：取得模块的Handle，用于接下来的GetProcAddress
		- [GetProcAddress](https://docs.microsoft.com/en-us/windows/desktop/api/libloaderapi/nf-libloaderapi-getprocaddress)：从DLL中取到Exported的函数或者变量的地址
	- How to implement Hook & Injection?
		- [CreateRemoteThread](https://docs.microsoft.com/en-us/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createremotethread): Creates a thread that runs in the virtual address space of another process
		- 将编译完的二进制模块加载进另一个进程
			- 使用VirtualAllocEx在目标进程的地址空间中创建一块我们DLL所在路径长度的内存空间。
			- 使用WriteProcessMemory将DLL路径写入分配的内存。
			- 一旦DLL路径写入内存中，再使用CreateRemoteThread（或者其他无正式说明的功能），它再调用LoadLibrary函数将DLL注入目标进程中。
		- 代码注入
			- 与dll注入相比，代码注入更隐蔽，不会留下assembly
			- 代码注入与dll注入的区别在于代码注入调用CreateRemoteThread时，会给出代码地址。
- Windbg Usage
	- [Getting Started With Windbg](https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/getting-started-with-windbg) ???
		- How to examine the Process Information?
		- How to viewing and edit Memory?
		- How to set a Breakpoint at function entries?
		- How to set a Breakpoint target writing memory?
		- How to use debugger extensions?
		- How to use !analyze in hang / crash scenarios?
		- Why my source code could not display with !analyze -v?
		- How to find error code of a win32 api that returns false
	- [Windbg Commands](https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/commands)
	- [Debugging Using WinDbg](https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/debugging-using-windbg)
	- [Standard Debugging Techniques](https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/standard-debugging-techniques)
	- [Viewing and Editing Memory in WinDbg](https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/memory-window)
- Windbg Advanced
	- [CrashMe Project](http://windbg.info/apps/46-crashme.html)
		- 01-breakpoint
			- Tools: [WER Dump](https://docs.microsoft.com/zh-cn/windows/desktop/wer/wer-settings)
			- Tools: [Procdump](https://docs.microsoft.com/en-us/sysinternals/downloads/procdump)
			- EventLog
			- Dump first check
			- `!analyze -v`
		- 02-asm-int-3
			- Faulting IP
			- Error Code
		- 03-raise-exception
			- kernelbase!RaiseException
		- 04-throw
			- `.dump /ma C:\test.dmp`
			- `kP`
			- `dd` <Exception Object>
		- 05-stackoverflow
			- [`windbg -I`](https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/windbg-command-line-options)
			- [enabling-postmortem-debugging](https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/enabling-postmortem-debugging)
			- [How to disable or enable Dr. Watson for Windows](https://support.microsoft.com/en-us/help/188296/how-to-disable-or-enable-dr-watson-for-windows)
			- [`kd`](https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/k--kb--kc--kd--kp--kp--kv--display-stack-backtrace-)
			- `uf <Address>`
		- 06-Division-By-NULL
		- 07-StackOverflow-with-recursion
		- 08-Nested-Exceptions
		- 09-Access-Test-Variable
			- Locals Window 
		- 10-check-for-debugger
		- 11-Enter-Critical-Section
		- 12-test-Calling-Conventions
		- 13-Invalid-Handles
		- 14-set-last-error
		- 15-HeapAlloc
		- 16-HeapDealloc
	- Demo
		- [Crash](https://msdn.microsoft.com/library/windows/desktop/ee416349)
		- [Hang](https://blogs.msdn.microsoft.com/benjaminperkins/2013/01/08/debugging-a-hung-application-with-windbg/)
		- [Hang2](https://blogs.msdn.microsoft.com/msdnts/2006/11/24/how-to-debug-application-crashhang-in-production-environment/)
		- [Native Memory Leak](https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/using-umdh-to-find-a-user-mode-memory-leak)
		- [Managed Memory Leak](https://blogs.msdn.microsoft.com/paullou/2011/06/28/debugging-managed-code-memory-leak-with-memory-dump-using-windbg/)
		- [CPU High](https://blogs.msdn.microsoft.com/ntdebugging/2008/05/15/how-to-track-down-high-cpu-in-user-mode-applications-a-live-debug/) 
			- `!runaway`
	- Scripts: [pykd](https://github.com/wu-wenxiang/Tool-Windbg-Pykd-Scripts)
	- Tools: [DebugDiag](https://www.microsoft.com/en-us/download/details.aspx?id=49924)
		- Demo: [How to use the Debug Diagnostics tool to troubleshoot a process that has stopped responding in IIS](https://support.microsoft.com/en-us/help/919792/how-to-use-the-debug-diagnostics-tool-to-troubleshoot-a-process-that-h)
		- Demo: [How to use the Debug Diagnostics Tool to troubleshoot high CPU usage by a process in IIS](https://support.microsoft.com/en-us/help/919791/how-to-use-the-debug-diagnostics-tool-to-troubleshoot-high-cpu-usage-b)
- What's More?
	- [Getting Started With Windbg Kernel Mode](https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/getting-started-with-windbg--kernel-mode-)
	- [Mex Extension](https://www.microsoft.com/en-us/download/details.aspx?id=53304): [Usage Blog](https://blogs.msdn.microsoft.com/luisdem/2016/07/19/mex-debugging-extension-for-windbg-2/)
		- `!mex.writemodule -a -p C:\testmodule`
		- `!mex.strings`
		- `!mex.runaway2`
		- `!mex.t`
		- `!mex.us -l`
	- [Debugging Using Windbg Preview](https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/debugging-using-windbg-preview)
	- [Time Travel Debugging Overview](https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/time-travel-debugging-overview)
	- Scripts: [javascript](https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/time-travel-debugging-javascript-automation)
